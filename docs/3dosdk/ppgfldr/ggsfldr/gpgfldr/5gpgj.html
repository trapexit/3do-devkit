<TITLE>Changing a Cel through Its CCB</TITLE>
<H1><LINK NAME="XREF41849">Changing a Cel through Its CCB</LINK></H1><HR>
A cel is animated by reprojecting the cel in each frame of the display and changing the cel's parameters from one frame to the next. The bitmapped background is typically refreshed between frames (as described in the last chapter) so that the cel's last projection is wiped clean before the new projection appears. A consistent change of cel characteristics from one frame to the next gives the cel the illusion of motion or animation.<P>
To animate a cel, you change its CCB between frames. The Graphics folio's wait call, <CODE>WaitVBL()</CODE>, helps time the CCB changing calls to occur during the vertical blank interval between frames. If you are double-buffering the animation, during or after the vertical blank you can project cels into the bitmap that is <I>not </I>displayed-just be sure you finish projection before the next vertical blank. <P>
<H2>Changing Cel Position</H2>
To change a cel's position within a bitmap or a screen, change the <CODE>XPOS</CODE> and <CODE>YPOS</CODE> values in the CCB from frame to frame. You can use fractional pixels for fine motion, and you can specify locations beyond the boundaries of the bitmap or screen on which you are projecting the cel. Cels are clipped when they go past bitmap or screen boundaries, or when they go past clipping boundaries set by <CODE>SetClipHeight()</CODE> and <CODE>SetClipWidth()</CODE>.<P>
<H2>Changing a Cel's Projection Quadrilateral</H2>
To change the shape or size of a cel (shrink it, enlarge it, or distort it), you can directly change the <CODE>HDX</CODE>, <CODE>HDY</CODE>, <CODE>VDX</CODE>, <CODE>VDY</CODE>, <CODE>HDDX</CODE>, and <CODE>HDDY</CODE> words of the CCB to set the cel's projection quadrilateral. This requires calculation to figure the appropriate slopes for the external and row boundaries of the cel. You can also use <CODE>MapCel()</CODE> to determine the projection quadrilateral.<P>
<CODE>MapCel()</CODE> accepts two arguments: a pointer to a cel's CCB and a pointer to an array of four point structures. These four point structures set the four corners of the cel's projection quadrilateral. <CODE>MapCel()</CODE> works out the projection quadrilateral from the four points, and automatically sets the quadrilateral offsets in the CCB.<P>
The four-point projection quadrilateral structure contains four pairs of point coordinates, the x coordinate followed by the y coordinate. Each point coordinate is a 32-bit value that is in 16.16 format. The four points within the structure are tied to the corners of the original cel source data, starting with the upper-left corner and proceeding clockwise:<P>
<UL>
<LI>Point 1 is tied to the upper-left corner of the cel.
<LI>Point 2 is tied to the upper-right corner of the cel.
<LI>Point 3 is tied to the lower-right corner of the cel.
<LI>Point 4 is tied to the lower-left corner of the cel.
</UL>
The points do not need to retain their clockwise nature; they can be rearranged to flip the cel vertically or horizontally, to twist the cel into a bow-tie shape, or to change the cel into whatever distorted shape you want that can be defined with four corner points.<P>
<H2>Skipping a Cel Within a Linked Group</H2>
When projecting a linked cel group over many frames, you may want to skip projecting one or more cels from the group. For example, an airplane object consisting of many linked cels could retract its landing gear. Once retracted, the landing gear cel within the group no longer needs to be projected.<P>
To skip a cel within a group, simply set the <CODE>SKIP</CODE> flag within the FLAGS word of its CCB. The connections between cels within the group remain intact, but the cel engine does not project any cels whose <CODE>SKIP</CODE> flags are set, saving cel engine processing time.<P>
<H2>Sequentially Animating a Cel</H2>
Although cels can be animated effectively by changing their position and projection quadrilateral, some animation is best done by flipping through a series of images-sequentially animating a cel. To sequentially animate a cel, you must create a series of source data files that contain the sequence of images you want to cycle within the cel. To keep things simple, these source data files should all use the same data type: either coded or uncoded, packed or unpacked, the same number of bits per pixel, and have the same dimensions. When multiple source data files are uniform in type and dimension, they can use the same preamble, which should be included within the CCB to save RAM.<P>
Once multiple source data files are set up, a cel can be sequentially animated by changing the contents of the CCB's <CODE>SOURCEPTR</CODE> word from frame to frame. <CODE>SOURCEPTR</CODE> points to a different source data file for each frame, and so presents a sequence of images within the cel. You can go through images in any order you wish, cycling through source data files, working forward and then backward through them, jumping from place to place, or whatever works best. You can also load new source data files to replace old ones that are no longer used.<P>
While a cel is sequentially animated from frame to frame, you can add to its animation by changing its position and its projection quadrilateral.<P>
<P>
